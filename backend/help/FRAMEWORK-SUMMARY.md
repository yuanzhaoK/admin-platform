# PocketBase é›†åˆåˆ›å»ºæ ‡å‡†åŒ–æ¡†æ¶ - æ€»ç»“

## ğŸ¯ é¡¹ç›®ç›®æ ‡

å°†ä¹‹å‰æ‰‹åŠ¨åˆ›å»º PocketBase é›†åˆçš„æµç¨‹æ ‡å‡†åŒ–ï¼Œæä¾›ä¸€ä¸ªå¯æ‰©å±•çš„æ¡†æ¶ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡é…ç½®æ–‡ä»¶è½»æ¾åˆ›å»ºä»»ä½•æƒ³è¦çš„é›†åˆã€‚

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ ¸å¿ƒæ¡†æ¶ (`collection-creator-framework.ts`)

åˆ›å»ºäº†ä¸€ä¸ªå®Œæ•´çš„ TypeScript æ¡†æ¶ç±» `PocketBaseCollectionCreator`ï¼ŒåŒ…å«ï¼š

- **ç®¡ç†å‘˜ç™»å½•** - è‡ªåŠ¨å¤„ç† PocketBase ç®¡ç†å‘˜è®¤è¯
- **å­—æ®µæ„å»ºå™¨** - æ”¯æŒæ‰€æœ‰ PocketBase å­—æ®µç±»å‹çš„è‡ªåŠ¨æ„å»º
- **é›†åˆåˆ›å»º** - å®Œæ•´çš„é›†åˆåˆ›å»ºæµç¨‹
- **æµ‹è¯•æ•°æ®ç”Ÿæˆ** - è‡ªåŠ¨ç”ŸæˆçœŸå®æµ‹è¯•æ•°æ®
- **é›†åˆéªŒè¯** - åˆ›å»ºåè‡ªåŠ¨éªŒè¯é›†åˆçŠ¶æ€
- **æ‰¹é‡æ“ä½œ** - æ”¯æŒæ‰¹é‡åˆ›å»ºå¤šä¸ªé›†åˆ
- **é”™è¯¯å¤„ç†** - å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è¾“å‡º

### 2. é›†åˆè“å›¾ç³»ç»Ÿ (`collection-blueprints.ts`)

æä¾›äº†é¢„å®šä¹‰çš„é›†åˆè“å›¾ï¼š

- **äº§å“é›†åˆ** - åŒ…å«åç§°ã€ä»·æ ¼ã€åˆ†ç±»ã€åº“å­˜ã€å›¾ç‰‡ã€è§„æ ¼ç­‰å­—æ®µ
- **æ–‡ç« é›†åˆ** - åŒ…å«æ ‡é¢˜ã€å†…å®¹ã€ä½œè€…å…³è”ã€åˆ†ç±»ã€æ ‡ç­¾ã€å‘å¸ƒçŠ¶æ€ç­‰
- **è¯„è®ºé›†åˆ** - åŒ…å«å†…å®¹ã€ä½œè€…å…³è”ã€æ–‡ç« å…³è”ã€çˆ¶è¯„è®ºã€å®¡æ ¸çŠ¶æ€ç­‰
- **ç”¨æˆ·è®¾ç½®é›†åˆ** - åŒ…å«ä¸»é¢˜ã€è¯­è¨€ã€æ—¶åŒºã€é€šçŸ¥åå¥½ç­‰

### 3. å‘½ä»¤è¡Œå·¥å…· (`create-collection-cli.ts`)

æä¾›äº†å‹å¥½çš„å‘½ä»¤è¡Œç•Œé¢ï¼š

- æ”¯æŒåˆ›å»ºå•ä¸ªé›†åˆæˆ–æ‰¹é‡åˆ›å»º
- ç¯å¢ƒå˜é‡é…ç½®æ”¯æŒ
- è¯¦ç»†çš„å¸®åŠ©ä¿¡æ¯å’Œé”™è¯¯æç¤º
- æ“ä½œè¿›åº¦æ˜¾ç¤º

### 4. ä½¿ç”¨ç¤ºä¾‹ (`create-collections-example.ts`)

æä¾›äº†å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ï¼š

- åˆå§‹åŒ–æ¡†æ¶
- ç®¡ç†å‘˜ç™»å½•
- åˆ›å»ºå•ä¸ªé›†åˆ
- æ‰¹é‡åˆ›å»ºé›†åˆ

### 5. å®Œæ•´æ–‡æ¡£

- **README.md** - é¡¹ç›®ä»‹ç»å’Œå¿«é€Ÿå¼€å§‹æŒ‡å—
- **COLLECTION-CREATOR-GUIDE.md** - è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—
- **FRAMEWORK-SUMMARY.md** - æœ¬æ€»ç»“æ–‡æ¡£

## ğŸ¯ æ”¯æŒçš„å­—æ®µç±»å‹

æ¡†æ¶æ”¯æŒæ‰€æœ‰ PocketBase å­—æ®µç±»å‹ï¼š

| å­—æ®µç±»å‹ | æ”¯æŒçš„é€‰é¡¹ | ç¤ºä¾‹ç”¨é€” |
|---------|-----------|---------|
| `text` | max, min, pattern, unique | æ ‡é¢˜ã€æè¿°ã€SKU |
| `number` | max, min, onlyInt | ä»·æ ¼ã€æ•°é‡ã€è¯„åˆ† |
| `bool` | - | å¼€å…³çŠ¶æ€ã€æ ‡è®° |
| `email` | max, min, pattern | é‚®ç®±åœ°å€ |
| `url` | max, min, pattern | ç½‘å€é“¾æ¥ |
| `date` | max, min | åˆ›å»ºæ—¶é—´ã€å‘å¸ƒæ—¶é—´ |
| `select` | maxSelect, values | çŠ¶æ€ã€åˆ†ç±»ã€æ ‡ç­¾ |
| `relation` | collectionName, cascadeDelete | ç”¨æˆ·å…³è”ã€æ–‡ç« å…³è” |
| `file` | fileMaxSize, mimeTypes, thumbs | å›¾ç‰‡ã€æ–‡æ¡£ä¸Šä¼  |
| `json` | jsonMaxSize | å¤æ‚æ•°æ®ç»“æ„ |

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

### 1. ç±»å‹å®‰å…¨
- å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- ç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥
- æ™ºèƒ½ä»£ç æç¤º

### 2. è‡ªåŠ¨åŒ–æµç¨‹
- ä¸€é”®åˆ›å»ºå¤æ‚é›†åˆ
- è‡ªåŠ¨å¤„ç†å­—æ®µIDç”Ÿæˆ
- è‡ªåŠ¨æŸ¥æ‰¾å…³è”é›†åˆID

### 3. çµæ´»é…ç½®
- é€šè¿‡è“å›¾æ–‡ä»¶é…ç½®é›†åˆ
- æ”¯æŒè‡ªå®šä¹‰å­—æ®µé€‰é¡¹
- æ”¯æŒæƒé™è§„åˆ™é…ç½®

### 4. æµ‹è¯•æ•°æ®ç”Ÿæˆ
- è‡ªåŠ¨ç”ŸæˆçœŸå®æµ‹è¯•æ•°æ®
- æ”¯æŒè‡ªå®šä¹‰æ•°æ®ç”Ÿæˆå™¨
- æ”¯æŒå…³è”æ•°æ®å¤„ç†

### 5. æ‰¹é‡æ“ä½œ
- æ”¯æŒæ‰¹é‡åˆ›å»ºå¤šä¸ªé›†åˆ
- è‡ªåŠ¨å¤„ç†ä¾èµ–å…³ç³»
- é”™è¯¯æ—¶åœæ­¢åç»­æ“ä½œ

### 6. å®Œå–„çš„éªŒè¯
- åˆ›å»ºåè‡ªåŠ¨éªŒè¯é›†åˆ
- æ˜¾ç¤ºå­—æ®µæ•°é‡å’Œè®°å½•ç»Ÿè®¡
- æä¾›ç¤ºä¾‹è®°å½•æŸ¥çœ‹

## ğŸ“‹ ä½¿ç”¨æµç¨‹

### 1. åŸºæœ¬ä½¿ç”¨æµç¨‹

```typescript
// 1. å¯¼å…¥æ¡†æ¶
import { PocketBaseCollectionCreator } from './collection-creator-framework.ts';

// 2. åˆ›å»ºå®ä¾‹
const creator = new PocketBaseCollectionCreator('http://localhost:8091');

// 3. ç®¡ç†å‘˜ç™»å½•
await creator.adminLogin('admin@example.com', 'password');

// 4. åˆ›å»ºé›†åˆ
await creator.createFromBlueprint(yourBlueprint);
```

### 2. è‡ªå®šä¹‰é›†åˆè“å›¾

```typescript
const customBlueprint: CollectionBlueprint = {
  collection: {
    name: 'my_collection',
    type: 'base',
    fields: [
      {
        name: 'title',
        type: 'text',
        required: true,
        options: { max: 200 }
      },
      {
        name: 'status',
        type: 'select',
        required: true,
        options: {
          maxSelect: 1,
          values: ['active', 'inactive']
        }
      }
    ]
  },
  testData: {
    count: 5,
    generator: (index: number) => ({
      title: `æ ‡é¢˜ ${index + 1}`,
      status: ['active', 'inactive'][index % 2]
    })
  }
};
```

### 3. å‘½ä»¤è¡Œä½¿ç”¨

```bash
# åˆ›å»ºå•ä¸ªé›†åˆ
npx tsx create-collection-cli.ts products

# æ‰¹é‡åˆ›å»ºæ‰€æœ‰é›†åˆ
npx tsx create-collection-cli.ts all

# æŸ¥çœ‹å¸®åŠ©
npx tsx create-collection-cli.ts --help
```

## ğŸ”§ æŠ€æœ¯å®ç°äº®ç‚¹

### 1. æ™ºèƒ½å­—æ®µæ„å»º

æ¡†æ¶èƒ½å¤Ÿæ ¹æ®å­—æ®µç±»å‹è‡ªåŠ¨æ„å»ºæ­£ç¡®çš„å­—æ®µé…ç½®ï¼š

```typescript
private async buildField(fieldConfig: FieldConfig): Promise<any> {
  // æ ¹æ®å­—æ®µç±»å‹è‡ªåŠ¨ç”Ÿæˆæ­£ç¡®çš„é…ç½®
  switch (fieldConfig.type) {
    case 'relation':
      // è‡ªåŠ¨æŸ¥æ‰¾å…³è”é›†åˆID
      let collectionId = fieldConfig.options?.collectionId;
      if (!collectionId && fieldConfig.options?.collectionName) {
        collectionId = await this.getCollectionId(fieldConfig.options.collectionName);
      }
      return { ...baseField, collectionId: collectionId || '' };
    // ... å…¶ä»–å­—æ®µç±»å‹å¤„ç†
  }
}
```

### 2. è‡ªåŠ¨å…³è”å¤„ç†

æ¡†æ¶èƒ½å¤Ÿè‡ªåŠ¨å¤„ç†é›†åˆé—´çš„å…³è”å…³ç³»ï¼š

```typescript
{
  name: 'user_id',
  type: 'relation',
  options: {
    collectionName: 'users',  // åªéœ€æä¾›é›†åˆåç§°
    cascadeDelete: true       // æ¡†æ¶è‡ªåŠ¨æŸ¥æ‰¾é›†åˆID
  }
}
```

### 3. å®Œæ•´çš„é”™è¯¯å¤„ç†

```typescript
try {
  const response = await fetch(url, options);
  if (response.ok) {
    // æˆåŠŸå¤„ç†
  } else {
    const errorData = await response.json();
    console.error('åˆ›å»ºå¤±è´¥:', errorData);
  }
} catch (error) {
  console.error('ç½‘ç»œé”™è¯¯:', error);
}
```

## ğŸ¨ æ‰©å±•æ€§è®¾è®¡

### 1. æ–°å­—æ®µç±»å‹æ”¯æŒ

åœ¨ `buildField` æ–¹æ³•ä¸­æ·»åŠ æ–°çš„ caseï¼š

```typescript
case 'your_new_type':
  return {
    ...baseField,
    // æ–°å­—æ®µç±»å‹çš„ç‰¹å®šé…ç½®
  };
```

### 2. è‡ªå®šä¹‰éªŒè¯è§„åˆ™

æ‰©å±• `CollectionConfig` æ¥å£ï¼š

```typescript
interface ExtendedCollectionConfig extends CollectionConfig {
  customRules?: {
    // è‡ªå®šä¹‰è§„åˆ™
  };
}
```

### 3. æ’ä»¶ç³»ç»Ÿ

å¯ä»¥é€šè¿‡ç»§æ‰¿ `PocketBaseCollectionCreator` ç±»æ¥æ‰©å±•åŠŸèƒ½ï¼š

```typescript
class ExtendedCreator extends PocketBaseCollectionCreator {
  async customMethod() {
    // è‡ªå®šä¹‰åŠŸèƒ½
  }
}
```

## ğŸ“Š é¡¹ç›®æˆæœ

### 1. ä»£ç ç»Ÿè®¡

- **æ ¸å¿ƒæ¡†æ¶**: ~400 è¡Œ TypeScript ä»£ç 
- **é›†åˆè“å›¾**: ~300 è¡Œé…ç½®ä»£ç 
- **å‘½ä»¤è¡Œå·¥å…·**: ~100 è¡Œå·¥å…·ä»£ç 
- **æ–‡æ¡£**: ~1000 è¡Œè¯¦ç»†æ–‡æ¡£

### 2. åŠŸèƒ½è¦†ç›–

- âœ… æ”¯æŒæ‰€æœ‰ PocketBase å­—æ®µç±»å‹
- âœ… æ”¯æŒå¤æ‚å…³è”å…³ç³»
- âœ… æ”¯æŒæ‰¹é‡æ“ä½œ
- âœ… æ”¯æŒæµ‹è¯•æ•°æ®ç”Ÿæˆ
- âœ… æ”¯æŒå‘½ä»¤è¡Œæ“ä½œ
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†
- âœ… è¯¦ç»†çš„æ–‡æ¡£è¯´æ˜

### 3. å®é™…åº”ç”¨

æ¡†æ¶å·²ç»æˆåŠŸåº”ç”¨äºï¼š

- âœ… è®¢å•ç®¡ç†ç³»ç»Ÿé›†åˆåˆ›å»º
- âœ… é€€æ¬¾è¯·æ±‚é›†åˆåˆ›å»º
- âœ… è®¢å•è®¾ç½®é›†åˆåˆ›å»º
- âœ… äº§å“ã€æ–‡ç« ã€è¯„è®ºç­‰é€šç”¨é›†åˆ

## ğŸš€ ä½¿ç”¨å»ºè®®

### 1. é¡¹ç›®ç»„ç»‡

```
your-project/
â”œâ”€â”€ collections/
â”‚   â”œâ”€â”€ framework/
â”‚   â”‚   â”œâ”€â”€ collection-creator-framework.ts
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”œâ”€â”€ blueprints/
â”‚   â”‚   â”œâ”€â”€ user-collections.ts
â”‚   â”‚   â”œâ”€â”€ product-collections.ts
â”‚   â”‚   â””â”€â”€ content-collections.ts
â”‚   â””â”€â”€ scripts/
â”‚       â”œâ”€â”€ create-all.ts
â”‚       â””â”€â”€ create-specific.ts
```

### 2. ç¯å¢ƒé…ç½®

```bash
# .env æ–‡ä»¶
POCKETBASE_URL=http://localhost:8091
ADMIN_EMAIL=admin@example.com
ADMIN_PASSWORD=your-secure-password
```

### 3. CI/CD é›†æˆ

```yaml
# GitHub Actions ç¤ºä¾‹
- name: Create Collections
  run: |
    npm install
    npx tsx create-collection-cli.ts all
```

## ğŸ‰ æ€»ç»“

è¿™ä¸ªæ ‡å‡†åŒ–æ¡†æ¶æˆåŠŸåœ°å°† PocketBase é›†åˆåˆ›å»ºæµç¨‹è‡ªåŠ¨åŒ–ï¼Œæä¾›äº†ï¼š

1. **å®Œæ•´çš„ç±»å‹å®‰å…¨** - TypeScript æ”¯æŒ
2. **çµæ´»çš„é…ç½®ç³»ç»Ÿ** - è“å›¾æ–‡ä»¶é…ç½®
3. **å¼ºå¤§çš„è‡ªåŠ¨åŒ–èƒ½åŠ›** - ä¸€é”®åˆ›å»ºå¤æ‚é›†åˆ
4. **ä¼˜ç§€çš„æ‰©å±•æ€§** - æ˜“äºæ·»åŠ æ–°åŠŸèƒ½
5. **å®Œå–„çš„æ–‡æ¡£** - è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—
6. **å®ç”¨çš„å·¥å…·** - å‘½ä»¤è¡Œç•Œé¢

ç”¨æˆ·ç°åœ¨å¯ä»¥é€šè¿‡ç®€å•çš„é…ç½®æ–‡ä»¶åˆ›å»ºä»»ä½•æƒ³è¦çš„ PocketBase é›†åˆï¼Œå¤§å¤§æé«˜äº†å¼€å‘æ•ˆç‡å¹¶å‡å°‘äº†é”™è¯¯ã€‚æ¡†æ¶çš„è®¾è®¡ä½¿å…¶æ˜“äºç»´æŠ¤å’Œæ‰©å±•ï¼Œä¸ºæœªæ¥çš„éœ€æ±‚å˜åŒ–æä¾›äº†è‰¯å¥½çš„åŸºç¡€ã€‚ 